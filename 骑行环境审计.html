<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8" />
<meta name="keywords" content="百度地图,百度地图API，百度地图自定义工具，百度地图所见即所得工具" />
<meta name="description" content="百度地图API自定义地图，帮助用户在可视化操作下生成百度地图" />
<meta http-equiv="Content-Type" content="text/html; charset=uft-8" />
<title>骑行环境审计</title>
<!--引用百度地图API-->
<style type="text/css">
    html,body{margin:0;padding:0;}
    .iw_poi_title {color:#CC5522;font-size:14px;font-weight:bold;overflow:hidden;padding-right:13px;white-space:nowrap}
    .iw_poi_content {font:12px arial,sans-serif;overflow:visible;padding-top:4px;white-space:-moz-pre-wrap;word-wrap:break-word}
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=1.1&services=true"></script>
<link
    href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css"
    rel="stylesheet" />
</head>
<body>
    <!--背景图-->
    <img src="u1.gif" style="width:423px; height:695px; opacity:0.6;position:relative;z-index:-1;"/>
    <!--标题（图标+中英文）-->
    <img src="u2.svg" style="position:absolute;left:20px;top:30px;width:80px;height:80px;opacity:0.7;"/>
    <div style="position:absolute;left:110px;top:23px;font-family:'华文宋体 Bold', '华文宋体', sans-serif;font-size:48px;">骑行环境审计</div>
    <div style="position:absolute;left:102px;top:80px;font-family:'Century Bold', 'Century Normal', 'Century', sans-serif;font-size:24px;">Biking Environment Audit</div>
    <!--左侧表单左侧表单左侧表单左侧表单左侧表单-->
    <!--图片名称-->
    <div style="position:absolute;left:20px;top:150px;height:40px;width:140px;font-family:'Arial Negreta', 'Arial Normal', 'Arial', sans-serif;font-size:28px;text-align:center;">图片名称：</div>
    <input id="pic_name" type="text" readonly style="position:absolute;left:160px;top:150px;width:244px;height:40px;"/>
    <!--评分细则-->
    <table id="score_table" border="1"style="position:absolute;left:20px;top:220px;height:80px;width:384px;text-align:center;">
        <tr>
        <th style="text-align:center;height:40px">安全性</th>
        <th style="text-align:center;height:40px">舒适性</th>
        <th style="text-align:center;height:40px">美观性</th>
        <th style="text-align:center;height:40px">设施完善性</th>
        <th style="text-align:center;height:40px">总分</th>
        </tr>
        <tr>
        <td> </td>
        <td> </td>
        <td> </td>
        <td> </td>
        <td> </td>
        </tr>
    </table>
    <!--经纬度-->
    <div style="position:absolute;left:20px;top:330px;height:40px;width:140px;font-family:'Arial Negreta', 'Arial Normal', 'Arial', sans-serif;font-size:28px;text-align:center;">经度：</div>
    <input id="longitude" type="text" style="position:absolute;left:160px;top:330px;width:244px;height:40px;" onclick="long_point()" />
    <script type="text/javascript">
        var long_point=function(){
            if(document.getElementById("long_point").style.visibility=="visible"){
            document.getElementById("long_point").style.visibility="hidden";//隐藏提示
            }
            else
            document.getElementById("long_point").style.visibility="visible";//显示提示
        }
    </script>
    <!--经度输入提示-->
    <div id="long_point" style="position:absolute;z-index: 1;left:160px;top:370px;width:244px;height:200px;background-color:rgba(151, 212, 241, 1);opacity:0.9;font-size:14px;text-align:center;visibility: hidden;">
        <div style="line-height:40px;" onclick="long_choose1()">114.269968（参考坐标1）</div>
        <script type="text/javascript">
            var long_choose1=function(){
                longitude.value=114.269968;//赋值
                long_point();//隐藏
            }
        </script>
        <div style="line-height:40px " onclick="long_choose2()">114.269971（参考坐标2）</div>
        <script type="text/javascript">
            var long_choose2=function(){
                longitude.value=114.269971;//赋值
                long_point();//隐藏
            }
        </script>
        <div style="line-height:40px;" onclick="long_choose3()">114.269988（参考坐标3）</div>
        <script type="text/javascript">
            var long_choose3=function(){
                longitude.value=114.269988;//赋值
                long_point();//隐藏
            }
        </script>
        <div style="line-height:40px;" onclick="long_choose4()">114.270030（参考坐标4）</div>
        <script type="text/javascript">
            var long_choose4=function(){
                longitude.value=114.270030;//赋值
                long_point();//隐藏
            }
        </script>
        <div style="line-height:40px;" onclick="long_choose5()">114.270039（参考坐标5）</div>
        <script type="text/javascript">
            var long_choose5=function(){
                longitude.value=114.270039;//赋值
                long_point();//隐藏
            }
        </script>
    </div>
    <div style="position:absolute;left:20px;top:400px;height:40px;width:140px;font-family:'Arial Negreta', 'Arial Normal', 'Arial', sans-serif;font-size:28px;text-align:center;">纬度：</div>
    <input id="latitude" type="text" style="position:absolute;left:160px;top:400px;width:244px;height:40px;" onclick="lati_point()"/>
    <script type="text/javascript">
        var lati_point=function(){
            if(document.getElementById("lati_point").style.visibility=="visible"){
            document.getElementById("lati_point").style.visibility="hidden";//隐藏提示
            }
            else
            document.getElementById("lati_point").style.visibility="visible";//显示提示
        }
    </script>
    <!--纬度输入提示-->
    <div id="lati_point" style="position:absolute;z-index: 1;left:160px;top:440px;width:244px;height:200px;background-color:rgba(151, 212, 241, 1);opacity:0.9;font-size:14px;text-align:center;visibility: hidden;">
        <div style="line-height:40px;" onclick="lati_choose1()">30.617831（参考坐标1）</div>
        <script type="text/javascript">
            var lati_choose1=function(){
                latitude.value=30.617831;//赋值
                lati_point();//隐藏
            }
        </script>
        <div style="line-height:40px " onclick="lati_choose2()">30.618120（参考坐标2）</div>
        <script type="text/javascript">
            var lati_choose2=function(){
                latitude.value=30.618120;//赋值
                lati_point();//隐藏
            }
        </script>
        <div style="line-height:40px;" onclick="lati_choose3()">30.617917（参考坐标3）</div>
        <script type="text/javascript">
            var lati_choose3=function(){
                latitude.value=30.617917;//赋值
                lati_point();//隐藏
            }
        </script>
        <div style="line-height:40px;" onclick="lati_choose4()">30.604048（参考坐标4）</div>
        <script type="text/javascript">
            var lati_choose4=function(){
                latitude.value=30.604048;//赋值
                lati_point();//隐藏
            }
        </script>
        <div style="line-height:40px;" onclick="lati_choose5()">30.608924（参考坐标5）</div>
        <script type="text/javascript">
            var lati_choose5=function(){
                latitude.value=30.608924;//赋值
                lati_point();//隐藏
            }
        </script>
    </div>
    <!--由地理位置查询分数-->
    <button type="button" class="btn btn-success btn-block" style="position:absolute;left:20px;top:470px;width:384px;height:40px;background-color:rgba(22, 130, 213, 1);border-width:0px;border-width:0px;"onclick="get_score()">由地理位置查询分数</button>
    <script type="text/javascript">
      var get_score=function(){
        var long=document.getElementById("longitude").value;//获取获取经度
        var lati=document.getElementById("latitude").value;//获取纬度
        if(long==''||lati==''){
            window.alert("输入不能为空！");
        }
        else{
            score_result.value=long+lati;//在评分结果框内显示(若该位置有多张图片则显示均分)
        }
      }
    </script>
    <!--评分-->
    <div style="position:absolute;left:20px;top:540px;height:40px;width:140px;font-family:'Arial Negreta', 'Arial Normal', 'Arial', sans-serif;font-size:28px;text-align:center;">评分：</div>
    <input id="score_result" type="text" style="position:absolute;left:160px;top:540px;width:244px;height:40px;"/>
    <!--由分数查询地理位置-->
    <button type="button" class="btn btn-success btn-block" style="position:absolute;left:20px;top:610px;width:384px;height:40px;background-color:rgba(22, 130, 213, 1);border-width:0px;border-width:0px;"onclick="get_location()">由分数查询地理位置</button>
    <script type="text/javascript">
      var get_location=function(){
        var scor=document.getElementById("score_result").value;//获取评分
        if(scor==''){
            window.alert("输入不能为空！");
        }
        else{
            window.alert("满足该评分的位置有:\n"+scor+"\n"+scor+"\n");//弹框显示(将满足条件的每个位置都显示出来)
        }
      }
    </script>
    <!--右侧地图右侧地图右侧地图右侧地图右侧地图-->
    <div style="position:absolute;left:423px;top:0px;width:943px;height:695px;border:#ccc solid 1px;" id="dituContent"></div>
    <script type="text/javascript">
        //创建和初始化地图函数：
        function initMap(){
            createMap();//创建地图
            setMapEvent();//设置地图事件
            addMapControl();//向地图添加控件
            addMarker();//向地图中添加marker
        }
        
        //创建地图函数：
        function createMap(){
            var map = new BMap.Map("dituContent");//在百度地图容器中创建一个地图
            var point = new BMap.Point(114.311586,30.598467);//定义一个中心点坐标
            map.centerAndZoom(point,12);//设定地图的中心点和坐标并将地图显示在地图容器中
            window.map = map;//将map变量存储在全局
        }
        
        //地图事件设置函数：
        function setMapEvent(){
            map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
            map.enableScrollWheelZoom();//启用地图滚轮放大缩小
            map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
            map.enableKeyboard();//启用键盘上下左右键移动地图
        }
        
        //地图控件添加函数：
        function addMapControl(){
            //向地图中添加缩放控件
        var ctrl_nav = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});
        map.addControl(ctrl_nav);
            //向地图中添加缩略图控件
        var ctrl_ove = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:1});
        map.addControl(ctrl_ove);
            //向地图中添加比例尺控件
        var ctrl_sca = new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});
        map.addControl(ctrl_sca);
        }
        
        //标注点数组！请在这里修改标注点！请在这里修改标注点！请在这里修改标注点！请在这里修改标注点！请在这里修改标注点！
        var markerArr = [{title:"街景1",point:"114.407644|30.524347",pic:"test1.png",icon:{w:21,h:21,l:0,t:0,x:6,lb:5}},{title:"街景2",point:"114.408644|30.525347",pic:"test2.png",icon:{w:21,h:21,l:0,t:0,x:6,lb:5}},{title:"街景3",point:"114.408544|30.524547",pic:"test3.png",icon:{w:21,h:21,l:0,t:0,x:6,lb:5}}
             ];
        //创建一个Icon
        function createIcon(json){
            var icon = new BMap.Icon("http://api.map.baidu.com/lbsapi/creatmap/images/us_mk_icon.png", new BMap.Size(json.w,json.h),{imageOffset: new BMap.Size(-json.l,-json.t),infoWindowOffset:new BMap.Size(json.lb+5,1),offset:new BMap.Size(json.x,json.h)})
            return icon;
        }
        //创建marker
        function addMarker(){
            for(var i=0;i<markerArr.length;i++){
                var json = markerArr[i];
                var p0 = json.point.split("|")[0];
                var p1 = json.point.split("|")[1];
                var point = new BMap.Point(p0,p1);
                var iconImg = createIcon(json.icon);
                var marker = new BMap.Marker(point,{icon:iconImg});
                var iw = createInfoWindow(i);
                var label = new BMap.Label(json.title,{"offset":new BMap.Size(json.icon.lb-json.icon.x+10,-20)});
                marker.setLabel(label);
                map.addOverlay(marker);
                label.setStyle({
                            borderColor:"#808080",
                            color:"#333",
                            cursor:"pointer"
                });
                
                (function(){
                    var index = i;
                    var _iw = createInfoWindow(i);
                    var _marker = marker;
                    _marker.addEventListener("click",function(){//添加点击文字事件
                        this.openInfoWindow(_iw);
                    });
                    _iw.addEventListener("open",function(){
                        _marker.getLabel().hide();
                        var reg = /\"(.*?)\./g;
                        m = reg.exec(_iw.content);//使用正则表达式提取InfoWindow窗口中的图片名称
                        pn=m[0].replace(/\W+/gi,'');
                        pic_name.value=pn;//在评分结果框内显示(若该位置有多张图片则显示均分)

                        var tb = document.getElementById('score_table');//获取bai表格的dudom节点
                        tb.rows[1].cells[0].innerHTML = pn;//动态修改表格的内容
                        tb.rows[1].cells[1].innerHTML = pn;//动态修改表格的内容
                        tb.rows[1].cells[2].innerHTML = pn;//动态修改表格的内容
                        tb.rows[1].cells[3].innerHTML = pn;//动态修改表格的内容
                        tb.rows[1].cells[4].innerHTML = pn;//动态修改表格的内容
                    })
                    _iw.addEventListener("close",function(){
                        _marker.getLabel().show();
                    })
                    label.addEventListener("click",function(){//添加点击图标事件
                        _marker.openInfoWindow(_iw);
                    })
                    if(!!json.isOpen){
                        label.hide();
                        _marker.openInfoWindow(_iw);
                    }
                })()
            }
        }
        //创建InfoWindow
        function createInfoWindow(i){
            var json = markerArr[i];
            var opts = {
                width: 500, // 信息窗口宽度
                title: '<h3 style="text-align: center">'+json.pic+'</h3>', // 信息窗口标题
                enableMessage: true, //设置允许信息窗发送短息
                message: ""
            }
            var html = '<img src="'+json.pic+'" width=100%>\n';
            var iw = new BMap.InfoWindow(html,opts);
            return iw;
        }
        
        initMap();//创建和初始化地图
    </script>
</body>
</html>